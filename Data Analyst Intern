# Install matplotlib if not installed
!pip install matplotlib

# Re-import necessary libraries
import pandas as pd
import matplotlib.pyplot as plt

# Reload datasets
user_details = pd.read_csv("data/UserDetails.csv")
cooking_sessions = pd.read_csv("data/CookingSessions.csv")
order_details = pd.read_csv("data/OrderDetails.csv")

# Clean and merge data (repeat any necessary preprocessing here)
user_details.fillna({"Age": user_details["Age"].mean(), "Gender": "Unknown"}, inplace=True)
cooking_sessions.dropna(subset=["DishPrepared"], inplace=True)
order_details.dropna(subset=["DishOrdered"], inplace=True)

merged_data = pd.merge(user_details, cooking_sessions, on="UserID", how="left")
merged_data = pd.merge(merged_data, order_details, on="UserID", how="left")

# Data analysis
popular_dishes = order_details["DishOrdered"].value_counts()
session_order_analysis = merged_data.groupby("UserID").agg({
    "DishPrepared": "count",
    "DishOrdered": "count"
}).reset_index()

# Visualization
popular_dishes.plot(kind="bar", color="skyblue")
plt.title("Popular Dishes Ordered")
plt.xlabel("Dish")
plt.ylabel("Order Count")
plt.xticks(rotation=45, ha="right")
plt.show()
